
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>我是妖怪</title>
	<meta name="author" content="YuLei Liao">

	
	<meta name="description" content="用过 Xcode 的都知道，Xcode 有一个非常讨厌的 bug，有时候更新资源后，真机调试发现资源还是旧的，这个时候只能 Clean 以后重新 Build。但这样非常浪费时间，特别是大一点的工程，编译一次就要几分钟。这个时候，程序员说不定就跑 moko.cc 去瞎逛了。。。 为了提高生产力， &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="我是妖怪" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="/javascripts/libs/jquery-1.7.2.min.js"></script>
	<script src="/javascripts/jquery.tableofcontents.min.js" type="text/javascript"></script>
	<script src="/javascripts/generate-toc.js" type="text/javascript"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">我是妖怪</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
    <li><a href="http://qeeplay.com/">My Team</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
    <li><a href="http://qeeplay.com/">My Team</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:dualface.github.com">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		
		<a class="github" href="https://github.com/dualface" title="GitHub">GitHub</a>
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:dualface.github.com">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner">


    <article class="post">
	<h1 class="title">
		
		<a href="/blog/2013/07/31/flush-res-when-build/">
		
			确保 Xcode 每次 Build 时都自动更新资源</a>
	</h1>
	<div class="entry-content">
		<p>用过 Xcode 的都知道，Xcode 有一个非常讨厌的 bug，有时候更新资源后，真机调试发现资源还是旧的，这个时候只能 Clean 以后重新 Build。但这样非常浪费时间，特别是大一点的工程，编译一次就要几分钟。这个时候，程序员说不定就跑 moko.cc 去瞎逛了。。。</p>

<p>为了提高生产力，我们需要一个脚本，在 Xcode Build 的时候强制更新资源。</p>

<br />


<h2>确定目录结构</h2>

<p>先看下图，Xcode 项目里蓝色的文件夹表示其中的文件会直接复制到真机上，并且保持目录结构。所以其中的 data，img，snd.ios 目录有什么内容，在真机上也会有什么内容。</p>

<p><img src="/upload/flush_res_when_build/01.png" alt="01.png" /></p>

<br />


<p>Xcode 在真机调试时，首先进行 Build，生成 .app 文件（实际是一个目录，不过 Finder 里面看着是一个文件），其中就包含了可执行文件和所有资源。然后 Xcode 会将 .app 传输到真机，最后在真机上启动 .app。所以我们的脚本就是在 Build 的时候，确保生成的 .app 里总是包含最新的资源。</p>

<p>这里就需要知道两个路径：原始资源文件所在的路径，以及 .app 中资源文件所在的路径。</p>

<p>第一个路径需要根据 Xcode 项目文件和资源文件的相对位置来确定。</p>

<p>如下图所示，工程文件在项目的 proj.ios 目录中，而资源文件在项目的 res 目录中。那么第一个路径就是</p>

<pre><code>工程文件所在路径/../res/
</code></pre>

<p><img src="/upload/flush_res_when_build/02.png" alt="02.png" /></p>

<p>由于 Xcode 提供了不少环境变量，所以“工程文件所在路径”和“.app 中资源文件所在的路径”都很容易确定，我们直接在脚本中引用即可。</p>

<br />


<h2>添加脚本</h2>

<p>Xcode 允许在 Build 时指定脚本代码，所以我们要修改 Xcode 的工程，加入脚本内容。</p>

<p>操作步骤：</p>

<ul>
<li><p>首先在 Xcode 里选中工程，右侧会显示工程的设置界面。</p></li>
<li><p>从设置界面选择 Build Phases 标签，然后点击右下角的 Add Build Phases 按钮，并选择“Add Run Script”。</p></li>
<li><p>在新出现的 Run Script 栏中输入以下内容：</p>

<pre><code>_TARGET_BUILD_CONTENTS_PATH=$TARGET_BUILD_DIR/$CONTENTS_FOLDER_PATH
echo _TARGET_BUILD_CONTENTS_PATH: $_TARGET_BUILD_CONTENTS_PATH
echo PWD: $PWD

echo Cleaning $_TARGET_BUILD_CONTENTS_PATH/

rm -fr $_TARGET_BUILD_CONTENTS_PATH/data/*
rm -fr $_TARGET_BUILD_CONTENTS_PATH/img/*
rm -fr $_TARGET_BUILD_CONTENTS_PATH/snd.ios/*

mkdir -p $_TARGET_BUILD_CONTENTS_PATH/data/
mkdir -p $_TARGET_BUILD_CONTENTS_PATH/img/
mkdir -p $_TARGET_BUILD_CONTENTS_PATH/snd.ios/

cp -RLp $PWD/../res/data/* $_TARGET_BUILD_CONTENTS_PATH/data/
cp -RLp $PWD/../res/img/* $_TARGET_BUILD_CONTENTS_PATH/img/
cp -RLp $PWD/../res/snd.ios/* $_TARGET_BUILD_CONTENTS_PATH/snd.ios/
</code></pre></li>
<li><p><strong>重要</strong>: 拖动 Run Script 栏，将其移动到列表的第二个位置（也就是 Target Dependencies 后面）。最后如下图：</p></li>
</ul>


<p><img src="/upload/flush_res_when_build/03.png" alt="03.png" /></p>

<br />


<h2>注意事项</h2>

<ol>
<li>脚本内容需要根据项目的目录结构、资源目录结构进行调整。</li>
<li>偶尔真机调试时，Xcode 会报告资源文件被修改。这时退出 Xcode 重新打开就好了，比重新编译快很多。</li>
</ol>


<p>- EOF -</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-07-31T09:35:00+08:00" pubdate data-updated="true">Jul 31<span>st</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/ios/'>ios</a>


</div>
	
		<span class="comments"><a href="/blog/2013/07/31/flush-res-when-build//index.html#disqus_thread">Comments</a></span>
	
</div>
</article>


    <article class="post">
	<h1 class="title">
		
		<a href="/blog/2013/02/28/from-flash-to-quick/">
		
			从 Flash 到 Cocos2d-x</a>
	</h1>
	<div class="entry-content">
		<p>前言：写这篇文章的原因是朋友公司打算将一个页游产品转为手游，邀请我过去做了两天培训。所以我根据 Flash 团队反映的一些问题做了有针对性的阐述。</p>

<p>Flash 团队转入 cocos2d-x 架构，面对的大部分问题实际上都是“实施”细节，语言根本不是障碍。为了让整个内容更有条理性，我以 Flash 团队提出的问题整理了一个提纲。然后我会按照这个提纲逐步完善文章内容（这次保证不会太监 ^_<sup>）。</sup></p>

<p>阅读索引：</p>

<ul>
<li>cocos2d-x 架构介绍，以及与 Flash 架构的主要差异</li>
<li>如何创建、编译、发布 cocos2d-x 项目</li>
<li>Lua 与 ActionScript 的主要差异</li>
<li>Lua 里如何实现面向对象</li>
<li>如何创建一个游戏架构，分离数据、逻辑、表现</li>
<li>cocos2d-x 里出现的各种事件，例如触摸、重力感应等</li>
<li>cocos2d-x 如何与服务端交互</li>
<li>资源的整合与优化</li>
<li>画面渲染和内存优化</li>
<li>创建自适应多种分辨率的 UI 界面</li>
</ul>


<p>从 Flash 体系转到 cocos2d-x 在技术上没有太多问题，更主要的门槛还是在工具链和具体实践上。</p>

<p>本文尽可能从 Flash 开发者的角度阐述如何转入 quick 体系。</p>

<p>项目地址： <a href="https://github.com/dualface/quick-cocos2d-x">https://github.com/dualface/quick-cocos2d-x</a></p>


		
		<a href="/blog/2013/02/28/from-flash-to-quick/" class="more-link">Read on &rarr;</a>
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-02-28T00:03:00+08:00" pubdate data-updated="true">Feb 28<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/cocos2d/'>cocos2d</a>, <a class='category' href='/blog/categories/lua/'>lua</a>, <a class='category' href='/blog/categories/quick/'>quick</a>


</div>
	
		<span class="comments"><a href="/blog/2013/02/28/from-flash-to-quick//index.html#disqus_thread">Comments</a></span>
	
</div>
</article>


    <article class="post">
	<h1 class="title">
		
		<a href="/blog/2013/01/27/call-objectivec-from-lua/">
		
			CCLuaObjcBridge - Lua 与 Objective-C 互操作的简单解决方案</a>
	</h1>
	<div class="entry-content">
		<p>月初的时候，发了一篇关于 <a href="/blog/2013/01/01/call-java-from-lua/">Lua 与 Java 互操作的文章</a>，里面提到了我创建的 LuaJavaBridge 工具。现在，最新的 Lua 与 Objective-C 互操作工具也出来了。因为是专门针对 cocos2d-x 的，所以命名为 CCLuaObjcBridge。</p>

<p>PS: 以前的 LuaJavaBridge 也会改名为 CCLuaJavaBridge，并且参考现在 CCLuaObjcBridge 的实现，做了不少改进，完成后也会发布。</p>

<p>CCLuaObjcBridge（后文简称 luaoc）的功能就是从 Lua 里直接掉用“任意 Objective-C 类方法”。利用这个特性，封装各种 iOS 上的库简直碉堡了，堪称 cocos2d-x Lua 游戏开发的神器 ^_^</p>


		
		<a href="/blog/2013/01/27/call-objectivec-from-lua/" class="more-link">Read on &rarr;</a>
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-01-27T13:08:00+08:00" pubdate data-updated="true">Jan 27<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/lua/'>lua</a>, <a class='category' href='/blog/categories/objectivec/'>objectivec</a>


</div>
	
		<span class="comments"><a href="/blog/2013/01/27/call-objectivec-from-lua//index.html#disqus_thread">Comments</a></span>
	
</div>
</article>


    <article class="post">
	<h1 class="title">
		
		<a href="/blog/2013/01/27/install-32bit-lua-on-macosx/">
		
			在 Mac OS X 上安装 Lua 32bit 环境</a>
	</h1>
	<div class="entry-content">
		<p>因为我们公司使用 <a href="https://github.com/dualface/quick-cocos2d-x">quick-cocos2d-x</a>（一个基于 cocos2d-x 的 Lua 游戏引擎）开发，所以在开发环境里必须配置 Lua，并且需要和移动设备上的 32bit Lua 匹配。</p>

<p>默认情况下，OS X 上编译 Lua 会编译成 64bit，所以需要做点手脚。此外还需要修改 LuaRocks，不然用 Lua 是编译成 32bit 了，可用 LuaRocks 安装的扩展还是 64bit。</p>


		
		<a href="/blog/2013/01/27/install-32bit-lua-on-macosx/" class="more-link">Read on &rarr;</a>
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-01-27T11:42:00+08:00" pubdate data-updated="true">Jan 27<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/lua/'>lua</a>


</div>
	
		<span class="comments"><a href="/blog/2013/01/27/install-32bit-lua-on-macosx//index.html#disqus_thread">Comments</a></span>
	
</div>
</article>


    <article class="post">
	<h1 class="title">
		
		<a href="/blog/2013/01/01/call-java-from-lua/">
		
			LuaJavaBridge - Lua 与 Java 互操作的简单解决方案</a>
	</h1>
	<div class="entry-content">
		<p>最近在游戏里要集成中国移动的 SDK，而这些 SDK 都是用 Java 编写的。由于我们整个游戏都是使用 Lua 开发的，所以就面对 Lua 与 Java 互操作的问题。</p>

<p>传统做法是先用 C/C++ 借助 JNI（Java Native Interface）编写调用 Java 的接口函数，然后再将这些函数通过 tolua++ 导出给 Lua 使用。这种做法最大的问题就是太繁琐，而且稍微有一点点修改，就要重新编译，严重降低了开发效率。</p>

<p>我尝试写了几个接口函数后，发现 JNI 提供了完善的接口来操作 Java，比如查找特定的 Class、Method 等等。既然有这些东西，我想完全可以实现一个很薄的转接层。这个层会提供一些函数，让 Lua 代码可以直接调用到 Java 的方法。</p>

<p>经过一番努力，LuaJavaBridge（简称 luaj）诞生了。</p>


		
		<a href="/blog/2013/01/01/call-java-from-lua/" class="more-link">Read on &rarr;</a>
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-01-01T01:01:00+08:00" pubdate data-updated="true">Jan 1<span>st</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/java/'>java</a>, <a class='category' href='/blog/categories/lua/'>lua</a>


</div>
	
		<span class="comments"><a href="/blog/2013/01/01/call-java-from-lua//index.html#disqus_thread">Comments</a></span>
	
</div>
</article>


    <article class="post">
	<h1 class="title">
		
		<a href="/blog/2012/08/25/tolua-plus-plus-implement/">
		
			Tolua++ 实现分析</a>
	</h1>
	<div class="entry-content">
		<p>tolua++ 是一个将 C/C++ 的函数和对象导出给 Lua 脚本使用的工具。</p>

<p>使用这个工具的基本步骤：</p>

<ul>
<li>将要导出的 C/C++ 函数和对象定义写入 .pkg 文件；</li>
<li>运行 tolua++ 工具，将 .pkg 文件编译为目标 .cpp 文件；</li>
<li>将目标 .cpp 文件加入项目，在启用 Lua 虚拟机后调用目标文件中的 open() 函数注册导出的内容。</li>
</ul>



		
		<a href="/blog/2012/08/25/tolua-plus-plus-implement/" class="more-link">Read on &rarr;</a>
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-08-25T11:05:00+08:00" pubdate data-updated="true">Aug 25<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/lua/'>lua</a>


</div>
	
		<span class="comments"><a href="/blog/2012/08/25/tolua-plus-plus-implement//index.html#disqus_thread">Comments</a></span>
	
</div>
</article>


    <article class="post">
	<h1 class="title">
		
		<a href="/blog/2012/08/17/cocos2d-x-2-dot-0-multi-resolution/">
		
			Cocos2d-x 2.0 自适应多种分辨率</a>
	</h1>
	<div class="entry-content">
		<p>cocos2d-x 2.0 提供一个极有价值的新特征: setDesignResolutionSize() 。</p>

<p>这个函数用于指定一个 OpenGL 视图，然后将这个视图映射到设备屏幕上。根据不同的设定，视图会自动缩放显示内容，为 cocos2d-x 自适应多种分辨率提供了基本支持。</p>


		
		<a href="/blog/2012/08/17/cocos2d-x-2-dot-0-multi-resolution/" class="more-link">Read on &rarr;</a>
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-08-17T23:17:00+08:00" pubdate data-updated="true">Aug 17<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/cocos2d/'>cocos2d</a>


</div>
	
		<span class="comments"><a href="/blog/2012/08/17/cocos2d-x-2-dot-0-multi-resolution//index.html#disqus_thread">Comments</a></span>
	
</div>
</article>


    <article class="post">
	<h1 class="title">
		
		<a href="/blog/2012/08/05/first-octopress-post/">
		
			转到新博客，Octopress 我来啦</a>
	</h1>
	<div class="entry-content">
		<p>初步试用 Octopress，感觉很爽，尤其是下面几点：</p>

<ul>
<li>支持 Markdown 格式编写 blog：WordPress 折腾半天各种 Markdown 插件效果都不理想；</li>
<li>支持代码高亮：WordPress 插入代码真心麻烦啊；</li>
<li>直接放在 github.com 上，省的自己配置了：越来越厌烦 Unix/Linux 下安装配置各种软件；</li>
<li>非常 Cool！</li>
</ul>


<p>好吧，希望新博客能够坚持写下去 :)</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-08-05T16:58:00+08:00" pubdate data-updated="true">Aug 5<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/blog/'>blog</a>


</div>
	
		<span class="comments"><a href="/blog/2012/08/05/first-octopress-post//index.html#disqus_thread">Comments</a></span>
	
</div>
</article>

<nav id="pagenavi">
    
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2013

    YuLei Liao

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'dualface';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







</body>
</html>